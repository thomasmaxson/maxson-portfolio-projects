!function($){"use strict";$(function(){function e(e){if(e){var t=new wp.shortcode({tag:"gallery",attrs:{ids:e},type:"single"}),r=wp.media.gallery.attachments(t),l=new wp.media.model.Selection(r.models,{props:r.props.toJSON(),multiple:!0});return l.gallery=r.gallery,l.more().done(function(){l.props.set({query:!1}),l.unmirror(),l.props.unset("orderby")}),l}return!1}var t,r=$("#project-gallery-image-ids").val(),l=e(r);$(document).on("click","#project-gallery-upload-button",function(r){function o(){t.toolbar.get("view").set({insert:{style:"primary",text:portfolio_projects_gallery_params.set_gallery,click:function(){var r=t.state().get("library"),o=[];r.each(function(e){o.push(e.id)}),this.el.innerHTML=portfolio_projects_gallery_params.saving_gallery,$.ajax({type:"POST",url:ajaxurl,data:{ids:o,action:"portfolio_project_process_gallery_images",nonce:portfolio_projects_gallery_params.nonce},success:function(r){if(1!=r.success)return t.close(),!1;var a=o.join(",");l=e(a),$("#project-gallery-image-ids").val(a),$("#project-gallery-images").html(r.data.gallery_html),t.close()},error:function(e,t,r){console.log(e.responseText),console.log(r)}})}}})}r.preventDefault();var a={title:portfolio_projects_gallery_params.create_gallery_title,toolbar:!1,frame:"post",state:"gallery-edit",editing:!0,multiple:!0,selection:l};(t||l)&&(a.title=portfolio_projects_gallery_params.edit_gallery_title),t=wp.media(a).open(),t.menu.get("view").unset("cancel"),t.menu.get("view").unset("separateCancel"),t.content.get("view").sidebar.unset("gallery"),t.menu.get("view").get("gallery-edit").el.innerHTML=a.title,t.menu.get("view").get("gallery-library").el.innerHTML=portfolio_projects_gallery_params.add_to_gallery_title,o(),t.on("toolbar:render:gallery-edit",function(){o()}).on("content:render:browse",function(e){e&&(e.sidebar.on("ready",function(){e.sidebar.unset("gallery")}),e.toolbar.on("ready",function(){"gallery-library"==e.toolbar.controller._state&&e.toolbar.$el.hide()}))}),t.state().get("library").on("remove",function(){0==t.state().get("library").length&&(l=!1,$.post(ajaxurl,{ids:"",action:"portfolio_project_save_gallery_images",nonce:portfolio_projects_gallery_params.nonce}))})})})}(jQuery);